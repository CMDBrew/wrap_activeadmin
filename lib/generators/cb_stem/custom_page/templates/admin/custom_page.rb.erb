ActiveAdmin.register <%= class_name %> do
  decorate_with Admin::<%= class_name %>Decorator

  permit_params :title, :description, :slug, :published_date,
                :published,
                seo_meta_config_attributes: %i[seo_title seo_description]

  actions :all, except: %i[show]

  # Controller
  controller do
    defaults finder: :find_by_slug
  end

  # INDEX
  filter :title
  filter :seo_meta_config,
         as: :select,
         multiple: true,
         include_blank: true,
         collection: proc { SeoMetaConfig.all.map { |x| [x.seo_title, x.id] } }
  filter :published
  filter :published_date

  index do
    selectable_column
    column 'Page Title', :title_with_link, sortable: 'title'
    column 'Status' do |<%= class_name.underscore %>|
      <%= class_name.underscore %>.published ? 'Published' : 'Scheduled'
    end
    column 'SEO Tags' do |<%= class_name.underscore %>|
      <%= class_name.underscore %>.seo_meta_config ? 'Customized' : 'Default'
    end
    column 'Last Update', :updated_at
    actions
  end

  # FORM
  form do |f|
    columns do
      column span: 2 do
        f.inputs 'Basics' do
          f.input :slug
          f.input :title, label: 'Page Title'
          f.input :description, label: 'Page Description'
          f.input :published
        end
        f.inputs 'SEO Tag',
                 for: [:seo_meta_config, <%= class_name.underscore %>.seo_meta_config || SeoMetaConfig.new] do |u|
          u.input :seo_title, label: 'SEO tags title'
          u.input :seo_description, label: 'SEO tags description'
        end
      end

      column do
        f.inputs 'Publish Time' do
          f.input :published_date, label: 'Publish in the future'
        end
      end
    end

    actions
  end
end
